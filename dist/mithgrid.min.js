/*
 * mithgrid JavaScript Library v0.0.1
 *
 * Date: Fri Jul 15 11:15:48 2011 -0400
 *
 * (c) Copyright University of Maryland 2011.  All rights reserved.
 *
 * (c) Copyright Texas A&M University 2010.  All rights reserved.
 *
 * Portions of this code are copied from The SIMILE Project:
 *  (c) Copyright The SIMILE Project 2006. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * 3. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */
var MITHGrid=MITHGrid||{},fluid=fluid||{},jQuery=jQuery||{};(function(a,b){window.console!==undefined&&window.console.log!==undefined?b.debug=window.console.log:b.debug=function(){},b.error=function(){b.debug.call({},arguments);return{arguments:arguments}};var c;c=function(a,d){a[d]===undefined&&(a[d]={namespace:function(b){return c(a[d],b)},debug:b.debug});return a[d]},b.namespace=function(a){return c(b,a)}})(jQuery,MITHGrid),function(a,b){var c=b.namespace("Data"),d={},e={};c.Set=function(b){var c={},d={},e=0,f=!0,g=[];c.isSet=!0,c.items=function(){var a;if(f){g=[];for(a in d)typeof a=="string"&&d[a]===!0&&g.push(a)}return g},c.add=function(a){d[a]===undefined&&(d[a]=!0,f=!0,e+=1)},c.remove=function(a){d[a]!==undefined&&(delete d[a],f=!0,e-=1)},c.visit=function(a){var b;for(b in d)if(a(b)===!0)break},c.contains=function(a){return d[a]!==undefined},c.size=function(){return f?c.items().length:g.length},b instanceof Array&&a(b).each(function(a,b){c.add(b)});return c},c.Type=function(a){var b={};b.name=a,b.custom={};return b},c.Property=function(a){var b={};b.name=a,b.getValueType=function(){return b.valueType||"text"};return b},c.Source=function(e){var f,g,h=!1,i=c.Set(),j={},k={},l={},m={},n=function(b,c,d,e){var f=b[c],g,h,i,j;f||(f={values:{},counts:{}},b[c]=f),g=f.values[d],h=f.counts[d],g||(g=[],f.values[d]=g);if(!h)h={},f.counts[d]=h;else if(a.inArray(e,g)!==-1){h[e]+=1;return}g.push(e),h[e]=1},o=function(a,b,c,d,e){var f=a[b],g,h,i,j;if(f){g=f.values[c];if(g)if(e)for(h=0,i=g.length;h<i;h+=1)j=g[h],e.contains(j)&&d.add(j);else for(h=0,i=g.length;h<i;h+=1)d.add(g[h])}},p=function(a,b,d,e,f){e||(e=c.Set()),b.visit(function(b){o(a,b,d,e,f)});return e};if(d[e.source]!==undefined)return d[e.source];f=fluid.initView("MITHGrid.Data.Source",a(window),e),d[e.source]=f,f.source=e.source,f.items=i.items,f.addProperty=function(a,b){var d=c.Property(a);b!==undefined&&b.valueType!==undefined&&(d.valueType=b.valueType),k[a]=d},f.getProperty=function(a){return k[a]===undefined?c.Property(a):k[a]},f.addType=function(a,b){var d=c.Type(a);j[a]=d},f.getType=function(a){return j[a]===undefined?c.Type(a):j[a]},f.getItem=function(a){if(l[a]!==undefined)return l[a].values;return{}},f.getItems=function(b){if(!a.isArray(b))return[f.getItem(b)];a.map(b,function(a,b){return f.getItem(a)})},f.fetchData=function(b){a.ajax({url:b,dataType:"json",success:function(a,b){f.loadData(a)}})},f.updateItems=function(b){var c,d,e,g,h=[],i,j=function(b,c,d,e){var f=b[c],g,h,i,j;if(!!f){g=f.values[d],h=f.counts[d];if(!g)return;if(!h)return;h[e]-=1,h[e]<1&&(i=a.inArray(e,g),i===0?g=g.slice(1):i===g.length-1?g=g.slice(0,i):i>0&&(g=g.slice(0,i).concat(g.slice(i+1))),f.values[d]=g)}},k=function(a,b,c){n(l,a,b,c),n(m,c,b,a)},o=function(a,b,c){j(l,a,b,c),j(m,c,b,a)},p=function(b,c,d){var e,g,h,i,j=b.id,k=b.type,l=!1,m=function(b,c){var d=!0;if(b.length!==c.length)return!1;a.each(b,function(a,b){b!==c[a]&&(d=!1)});return d},n=function(b,c,e){a.each(e,function(a,e){d(b,c,e)})},o=function(b,d,e){a.each(e,function(a,e){c(b,d,e)})};a.isArray(j)&&(j=j[0]),a.isArray(k)&&(k=k[0]),e=f.getItem(j);for(g in b){if(typeof g!="string"||g==="id"||g==="type")continue;h=b[g],a.isArray(h)||(h=[h]),i=h.length;if(e[g]!==undefined){if(m(h,e[g]))continue;l=!0,n(j,g,e[g])}o(j,g,h)}return l};f.events.onBeforeUpdating.fire(f),d=b.length,e=parseInt(d/100,10),e>200&&(e=200),e<1&&(e=1),g=function(a){var c,j;c=a+e,c>d&&(c=d);for(j=a;j<c;j+=1)i=b[j],typeof i=="object"&&p(i,k,o)&&h.push(i.id);c<d?setTimeout(function(){g(c)},0):setTimeout(function(){f.events.onAfterUpdating.fire(f),setTimeout(function(){f.events.onModelChange.fire(f,h)},0)},0)},g(0)},f.loadItems=function(c,d){var e,g,h,j,k=[],o,p=function(a,b,c){n(l,a,b,c),n(m,c,b,a)},q=function(c,d){var e,f,g,h,j,l;if(c.id===undefined)throw b.error("Item entry has no id: ",c);if(c.type===undefined)throw b.error("Item entry has no type: ",c);e=c.id,f=c.type,a.isArray(e)&&(e=e[0]),a.isArray(f)&&(f=f[0]),i.add(e),k.push(e),p(e,"type",f),p(e,"id",e);for(g in c){if(typeof g!="string")continue;if(g!=="id"&&g!=="type"){j=c[g];if(a.isArray(j))for(h=0,l=j.length;h<l;h+=1)p(e,g,j[h]);else j!==undefined&&j!==null&&p(e,g,j)}}};f.events.onBeforeLoading.fire(f),h=c.length,a.isFunction(d)?(j=parseInt(h/100,10),j>200&&(j=200),j<1&&(j=1)):j=h,o=function(b){var e,i;e=b+j,e>h&&(e=h);for(i=b;i<e;i+=1)g=c[i],typeof g=="object"&&q(g);e<h?setTimeout(function(){o(e)},0):setTimeout(function(){f.events.onAfterLoading.fire(f),setTimeout(function(){f.events.onModelChange.fire(f,k),a.isFunction(d)&&d()},0)},0)},o(0)},f.prepare=function(c){var d=a.map(c,function(a){return b.Expression.Parser().parse(a)});return{evaluate:function(b){var c=[];a.each(d,function(a,d){var e=d.evaluateOnItem(b,f);c=c.concat(e.values.items())});return c}}},f.getObjectsUnion=function(a,b,c,d){return p(l,a,b,c,d)},f.getSubjectsUnion=function(a,b,c,d){return p(m,a,b,c,d)};return f},c.View=function(b){var d,f=c.Set();if(e[b.label]!==undefined)return e[b.label];d=fluid.initView("MITHGrid.Data.View",a(window),b),d.registerFilter=function(a){d.events.onFilterItem.addListener(function(b,c){return a.eventFilterItem(b,c)}),d.events.onModelChange.addListener(function(b,c){a.eventModelChange(b,c)}),a.events.onFilterChange.addListener(d.eventFilterChange)},d.registerView=function(a){d.events.onModelChange.addListener(function(b,c){a.eventModelChange(b,c)}),d.filterItems(function(){a.eventModelChange(d,d.items())})},d.items=f.items,d.size=f.size,b.collection!==undefined&&d.registerFilter({eventFilterItem:b.collection,eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}}),d.filterItems=function(a){var b,e,g,h,i,j;f=c.Set(),d.items=f.items,d.size=f.size,g=d.dataSource.items(),h=g.length;h===0?a():(i=parseInt(h/100,10),i>200&&(i=200),i<1&&(i=1),j=function(c){var e,k,l;l=c+i,l>h&&(l=h);for(e=c;e<l;e+=1)b=g[e],k=d.events.onFilterItem.fire(d.dataSource,b),k!==!1&&f.add(b);l<h?setTimeout(function(){j(l)},0):a&&setTimeout(a,0)},j(0))},d.eventModelChange=function(b,e){var f=c.Set(d.items());d.filterItems(function(){var b=c.Set(),g,h;a.each(d.items(),function(a,b){f.add(b)}),h=e.length;for(g=0;g<h;g+=1)f.contains(e[g])&&b.add(e[g]);b.size()>0&&d.events.onModelChange.fire(d,b.items())})},d.eventFilterChange=d.eventModelChange,d.dataSource=c.Source({source:b.source}),d.getItems=d.dataSource.getItems,d.getItem=d.dataSource.getItem,d.fetchData=d.dataSource.fetchData,d.updateItems=d.dataSource.updateItems,d.loadItems=d.dataSource.loadItems,d.prepare=d.dataSource.prepare,d.addType=d.dataSource.addType,d.getType=d.dataSource.getType,d.addProperty=d.dataSource.addProperty,d.getProperty=d.dataSource.getProperty,d.getObjectsUnion=d.dataSource.getObjectsUnion,d.getSubjectsUnion=d.dataSource.getSubjectsUnion,d.dataSource.events.onModelChange.addListener(d.eventModelChange);return d}}(jQuery,MITHGrid),function(a,b){var c=b.namespace("Expression"),d={"+":{argumentType:"number",valueType:"number",f:function(a,b){return a+b}},"-":{argumentType:"number",valueType:"number",f:function(a,b){return a-b}},"*":{argumentType:"number",valueType:"number",f:function(a,b){return a*b}},"/":{argumentType:"number",valueType:"number",f:function(a,b){return a/b}},"=":{valueType:"boolean",f:function(a,b){return a===b}},"<>":{valueType:"boolean",f:function(a,b){return a!==b}},"><":{valueType:"boolean",f:function(a,b){return a!==b}},"<":{valueType:"boolean",f:function(a,b){return a<b}},">":{valueType:"boolean",f:function(a,b){return a>b}},"<=":{valueType:"boolean",f:function(a,b){return a<=b}},">=":{valueType:"boolean",f:function(a,b){return a>=b}}};c.Controls={"if":{f:function(a,b,c,d,e){var f=a[0].evaluate(b,c,d,e),g=!1;f.forEachValue(function(a){if(a){g=!0;return!0}});return g?a[1].evaluate(b,c,d,e):a[2].evaluate(b,c,d,e)}},foreach:{f:function(a,b,d,e,f){var g=a[0].evaluate(b,d,e,f),h=b.value,i=d.value,j=[],k="text",l;d.value=g.valueType,g.forEachValue(function(c){b.value=c,l=a[1].evaluate(b,d,e,f),k=l.valueType,l.forEachValue(function(a){j.push(a)})}),b.value=h,d.value=i;return c.Collection(j,k)}},"default":{f:function(a,b,d,e,f){var g,h,i;for(g=0,h=a.length;g<h;g+=1){i=a[g].evaluate(b,d,e,f);if(i.size()>0)return i}return c.Collection([],"text")}}},c.Expression=function(a){var b={};b.evaluate=function(b,c,d,e){var f=a.evaluate(b,c,d,e);return{values:f.getSet(),valueType:f.valueType,size:f.size}},b.evaluateOnItem=function(a,b){return this.evaluate({value:a},{value:"item"},"value",b)},b.evaluateSingle=function(b,c,d,e){var f=a.evaluate(b,c,d,e),g={value:null,valueType:f.valueType};f.forEachValue(function(a){g.value=a;return!0});return g},b.isPath=a.isPath,b.isPath?(b.getPath=function(){return a},b.testExists=function(b,c,d,e){return a.testExists(b,c,d,e)}):(b.getPath=function(){return null},b.testExists=function(a,c,d,e){return b.evaluate(a,c,d,e).values.size()>0}),b.evaluateBackward=function(b,c,d,e){return a.walkBackward([b],c,d,e)},b.walkForward=function(b,c,d){return a.walkForward(b,c,d)},b.walkBackward=function(b,c,d,e){return a.walkBackward(b,c,d,e)};return b},c.Collection=function(a,c){var d={valueType:c};a instanceof Array?(d.forEachValue=function(b){var c=a,d,e;for(d=0,e=c.length;d<e;d+=1)if(b(c[d])===!0)break},d.getSet=function(){return b.Data.Set(a)},d.contains=function(b){var c=a,d,e;for(d=0,e=c.length;d<e;d+=1)if(c[d]===b)return!0;return!1},d.size=function(){return a.length}):(d.forEachValue=function(b){return a.visit(b)},d.getSet=function(){return a},d.contains=function(b){return a.contains(b)},d.size=a.size),d.isPath=!1;return d},c.Constant=function(a,b){var d={};d.evaluate=function(d,e,f,g){return c.Collection([a],b)},d.isPath=!1;return d},c.Operator=function(a,b){var e={},f=a,g=b;e.evaluate=function(a,b,e,h){var i=[],j=[],k,l,m,n;for(k=0,l=g.length;k<l;k+=1)j.push(g[k].evaluate(a,b,e,h));m=d[f],n=m.f,m.argumentType==="number"?j[0].forEachValue(function(a){typeof a!="number"&&(a=parseFloat(a)),j[1].forEachValue(function(b){typeof b!="number"&&(b=parseFloat(b)),i.push(n(a,b))})}):j[0].forEachValue(function(a){j[1].forEachValue(function(b){i.push(n(a,b))})});return c.Collection(i,m.valueType)},e.isPath=!1;return e},c.FunctionCall=function(a,b){var d={},e=a,f=b;d.evaluate=function(a,b,d,g){var h=[],i,j;for(i=0,j=f.length;i<j;i+=1)h.push(f[i].evaluate(a,b,d,g));if(c.Functions[e]!==undefined)return c.Functions[e].f(h);throw new Error("No such function named "+e)},d.isPath=!1;return d},c.ControlCall=function(a,b){var d={},e=a,f=b;d.evaluate=function(a,b,d,g){return c.Controls[e].f(f,a,b,d,g)},d.isPath=!1;return d},c.Path=function(a,d){var e={},f=null,g=[],h=function(a,b){var d,e,f,h,i,j,k,l=function(c){var d=[];a.forEachValue(function(a){b.getObjects(a,c.property).visit(function(a){d.push(a)})});return d},m=function(c){var d=[];a.forEachValue(function(a){b.getSubjects(a,c.property).visit(function(a){d.push(a)})});return d};for(d=0,e=g.length;d<e;d+=1)f=g[d],f.isMultiple?(h=[],f.forward?(h=l(f),j=b.getProperty(f.property),i=j!==null?j.getValueType():"text"):(h=m(f),i="item"),a=c.Collection(h,i)):f.forward?(k=b.getObjectsUnion(a.getSet(),f.property),j=b.getProperty(f.property),i=j!==null?j.getValueType():"text",a=c.Collection(k,i)):(k=b.getSubjectsUnion(a.getSet(),f.property),a=c.Collection(k,"item"));return a},i=function(a,d,e){var f,h,i,j,k,l,m=function(b){var c=[];a.forEachValue(function(a){e.getSubjects(a,b.property).visit(function(a){(f>0||d===null||d.contains(a))&&c.push(a)})});return c},n=function(b){var c=[];a.forEachValue(function(a){e.getObjects(a,b.property).visit(function(a){(f>0||d===null||d.contains(a))&&c.push(a)})});return c};d instanceof Array&&(d=b.Data.Set(d));for(f=g.length-1;f>=0;f-=1)h=g[f],h.isMultiple?(i=[],h.forward?(i=m(h),k=e.getProperty(h.property),j=k!==null?k.getValueType():"text"):(i=n(h),j="item"),a=c.Collection(i,j)):h.forward?(l=e.getSubjectsUnion(a.getSet(),h.property,null,f===0?d:null),a=c.Collection(l,"item")):(l=e.getObjectsUnion(a.getSet(),h.property,null,f===0?d:null),k=e.getProperty(h.property),j=k!==null?k.getValueType():"text",a=c.Collection(l,j));return a};a!==undefined&&g.push({property:a,forward:d,isMultiple:!1}),e.isPath=!0,e.setRootName=function(a){f=a},e.appendSegment=function(a,b){g.push({property:a,forward:b.charAt(0)===".",isMultiple:b.length>1})},e.getSegment=function(a){var b;if(a<g.length){b=g[a];return{property:b.property,forward:b.forward,isMultiple:b.isMultiple}}return null},e.getLastSegment=function(){return e.getSegment(g.length-1)},e.getSegmentCount=function(){return g.length},e.rangeBackward=function(c,d,e,f){var h=b.Data.Set(),i="item",j,k;if(g.length>0){j=g[g.length-1];if(j.forward)f.getSubjectsInRange(j.property,c,d,!1,h,g.length===1?e:null);else throw new Error("Last path of segment must be forward");for(k=g.length-2;k>=0;k-=1)j=g[k],j.forward?(h=f.getSubjectsUnion(h,j.property,null,k===0?e:null),i="item"):(h=f.getObjectsUnion(h,j.property,null,k===0?e:null),a=f.getProperty(j.property),i=a!==null?a.getValueType():"text")}return{valueType:i,values:h,count:h.size()}},e.evaluate=function(a,b,d,e){var g=f!==null?f:d,i=b[g]!==undefined?b[g]:"text",j=null,k;if(a[g]!==undefined){k=a[g],k.isSet||k instanceof Array?j=c.Collection(k,i):j=c.Collection([k],i);return h(j,e)}throw new Error("No such variable called "+g)},e.testExists=function(a,b,c,d){return e.evaluate(a,b,c,d).size()>0},e.evaluateBackward=function(a,b,d,e){var f=c.Collection([a],b);return i(f,d,e)},e.walkForward=function(a,b,d){return h(c.Collection(a,b),d)},e.walkBackward=function(a,b,d,e){return i(c.Collection(a,b),d,e)};return e},c.Parser=function(){var a={},b=function(a,b){var d=a.token(),e,f,g,h,i=c.Scanner,j=function(){a.next(),d=a.token()},k=function(){},l=function(){var a=k(),b;while(d!==null&&d.type===i.OPERATOR&&(d.value==="*"||d.value==="/"))b=d.value,j(),a=c.Operator(b,[a,k()]);return a},m=function(){var a=l(),b;while(d!==null&&d.type===i.OPERATOR&&(d.value==="+"||d.value==="-"))b=d.value,j(),a=c.Operator(b,[a,l()]);return a},n=function(){var a=m(),b;while(d!==null&&d.type===i.OPERATOR&&(d.value==="="||d.value==="<>"||d.value==="<"||d.value==="<="||d.value===">"||d.value===">="))b=d.value,j(),a=c.Operator(b,[a,m]);return a},o=function(){var a=[n()];while(d!==null&&d.type===i.DELIMITER&&d.value===",")j(),a.push(n());return a},p=function(){return d!==null?d.start:a.index()},q=function(){var a=c.Path(),b;while(d!==null&&d.type===i.PATH_OPERATOR){b=d.value,j();if(d!==null&&d.type===i.IDENTIFIER)a.appendSegment(d.value,b),j();else throw new Error("Missing property ID at position "+p())}return a};k=function(){var a=null,b=[],e;if(d===null)throw new Error("Missing factor at end of expression");switch(d.type){case i.NUMBER:a=c.Constant(d.value,"number"),j();break;case i.STRING:a=c.Constant(d.value,"text"),j();break;case i.PATH_OPERATOR:a=q();break;case i.IDENTIFIER:e=d.value,j();if(c.Controls[e]!==undefined){if(d===null||d.type!==i.DELIMITER||d.value!=="(")throw new Error("Missing ( to start "+e+" at position "+p());j(),b=d!==null&&d.type===i.DELIMITER&&d.value===")"?[]:o(),a=c.ControlCall(e,b);if(d!==null&&d.type===i.DELIMITER&&d.value===")")j();else throw new Error("Missing ) to end "+e+" at position "+p())}else if(d!==null&&d.type===i.DELIMITER&&d.value==="("){j(),b=d!==null&&d.type===i.DELIMITER&&d.value===")"?[]:o(),a=c.FunctionCall(e,b);if(d!==null&&d.type===i.DELIMITER&&d.value===")")j();else throw new Error("Missing ) after function call "+e+" at position "+p())}else a=q(),a.setRootName(e);break;case i.DELIMITER:if(d.value!=="(")throw new Error("Unexpected text "+d.value+" at position "+p());j(),a=n();if(d!==null&&d.type===i.DELIMITER&&d.value===")")j();else throw new Error("Missing ) at position "+p());break;default:throw new Error("Unexpected text "+d.value+" at position "+p())}return a};if(b){e=o(),f=[];for(g=0,h=e.length;g<h;g+=1)f.push(c.Expression(e[g]));return f}return[c.Expression(n())]};a.parse=function(a,d,e){var f;d=d||0,e=e||{},f=c.Scanner(a,d);try{return b(f,!1)[0]}finally{e.index=f.token()!==null?f.token().start:f.index()}};return a},c.Scanner=function(a,b){var d={},e=a+" ",f=a.length,g=b,h=null,i=function(a){return"0123456789".indexOf(a)>=0};d.token=function(){return h},d.index=function(){return g},d.next=function(){var a,b,d,j;h=null;while(g<f&&" \t\r\n".indexOf(e.charAt(g))>=0)g+=1;if(g<f){a=e.charAt(g),b=e.charAt(g+1);if(".!".indexOf(a)<0)if("<>".indexOf(a)<0)if("+-*/=".indexOf(a)<0)if("()".indexOf(a)<0)if("\"'".indexOf(a)<0)if(i(a)){d=g;while(d<f&&i(e.charAt(d)))d+=1;if(d<f&&e.charAt(d)==="."){d+=1;while(d<f&&i(e.charAt(d)))d+=1}h={type:c.Scanner.NUMBER,value:parseFloat(e.substring(g,d)),start:g,end:d},g=d}else{d=g;while(d<f){j=e.charAt(d);if("(),.!@ \t".indexOf(j)<0)d+=1;else break}h={type:c.Scanner.IDENTIFIER,value:e.substring(g,d),start:g,end:d},g=d}else{d=g+1;while(d<f){if(e.charAt(d)===a&&e.charAt(d-1)!=="\\")break;d+=1}if(d<f)h={type:c.Scanner.STRING,value:e.substring(g+1,d).replace(/\\'/g,"'").replace(/\\"/g,'"'),start:g,end:d+1},g=d+1;else throw new Error("Unterminated string starting at "+String(g))}else h={type:c.Scanner.DELIMITER,value:a,start:g,end:g+1},g+=1;else h={type:c.Scanner.OPERATOR,value:a,start:g,end:g+1},g+=1;else b==="="||"<>".indexOf(b)>=0&&a!==b?(h={type:c.Scanner.OPERATOR,value:a+b,start:g,end:g+2},g+=2):(h={type:c.Scanner.OPERATOR,value:a,start:g,end:g+1},g+=1);else b==="@"?(h={type:c.Scanner.PATH_OPERATOR,value:a+b,start:g,end:g+2},g+=2):(h={type:c.Scanner.PATH_OPERATOR,value:a,start:g,end:g+1},g+=1)}},d.next();return d},c.Scanner.DELIMITER=0,c.Scanner.NUMBER=1,c.Scanner.STRING=2,c.Scanner.IDENTIFIER=3,c.Scanner.OPERATOR=4,c.Scanner.PATH_OPERATOR=5,c.Functions={},c.FunctionUtilities={},c.FunctionUtilities.registerSimpleMappingFunction=function(a,d,e){c.Functions[a]={f:function(a){var g=b.Data.Set(),h=function(a){a.forEachValue(function(a){var b=d(a);b!==undefined&&g.add(b)})},i;for(i=0;i<a.length;i+=1)h(a[i]);return c.Collection(g,e)}}},c.FunctionUtilities.registerSimpleMappingFunction("$",function(a){return a},"Item")}(jQuery,MITHGrid),function(a,b){b.namespace("Presentation"),b.Presentation.initView=function(b,c,d){var e=fluid.initView("MITHGrid.Presentation."+b,c,d),f={};d=e.options,a(c).empty(),e.eventModelChange=function(a,b){var c;e.renderItems(a,b)},e.renderingFor=function(a){return f[a]},e.renderItems=function(a,b){var d=b.length,g;g=function(h){var i,j,k,l,m;if(h<d){i=d,d>200&&(i=h+parseInt(Math.sqrt(d),10)+1,i>d&&(i=d));for(j=h;j<i;j+=1)k=b[j],l=a.getItem(k),l?f[k]?f[k].update(l):(m=e.getLens(l),m&&(f[k]=m.render(c,e,a,b[j]))):f[k]&&f[k].remove();e.finishDisplayUpdate(),setTimeout(function(){g(i)},0)}},e.startDisplayUpdate(),g(0)},e.startDisplayUpdate=function(){a(c).empty()},e.finishDisplayUpdate=function(){a("<div class='clear'></div>").appendTo(a(c))},e.selfRender=function(){e.startDisplayUpdate(),e.renderItems(e.options.source,e.options.source.items()),e.finishDisplayUpdate()},e.dataView=e.options.source,e.options.source.registerView(e);return e}}(jQuery,MITHGrid),function(a,b){var c=b.namespace("Application");c.initApp=function(c,d,e){var f={presentation:{},dataSource:{},dataView:{}},g=[];f.ready=function(a){g.push(a)},e.dataSources!==undefined&&a.each(e.dataSources,function(c,d){var e=b.Data.Source({source:d.label});f.dataSource[d.label]=e,e.addType("Item"),e.addProperty("label",{valueType:"text"}),e.addProperty("type",{valueType:"text"}),e.addProperty("id",{valueType:"text"}),d.types!==undefined&&a.each(d.types,function(a,b){e.addType(b.label)}),d.properties!==undefined&&a.each(d.properties,function(a,b){e.addProperty(b.label,b)})}),e.dataViews!==undefined&&a.each(e.dataViews,function(a,c){var d={},e={source:c.dataSource,label:c.label};c.collection!==undefined&&(e.collection=c.collection),d=b.Data.View(e),f.dataView[c.label]=d}),e.viewSetup!==undefined&&(a.isFunction(e.viewSetup)?f.ready(function(){e.viewSetup(a(d))}):f.ready(function(){a(d).append(e.viewSetup)})),e.presentations!==undefined&&f.ready(function(){a.each(e.presentations,function(b,c){var d=a.extend(!0,{},c.options),e=a(c.container),g;a.isArray(e)&&(e=e[0]),d.source=f.dataView[c.dataView],g=c.type(e,d),f.presentation[c.label]=g,g.selfRender()})}),e.plugins!==undefined&&f.ready(function(){a.each(e.plugins,function(b,c){var d=c.type(c);d!==undefined&&(c.dataView!==undefined&&(d.dataView=f.dataView[c.dataView],a.each(d.getTypes(),function(a,b){d.dataView.addType(b)}),a.each(d.getProperties(),function(a,b){d.dataView.addProperty(b.label,b)})),a.each(d.getPresentations(),function(b,e){var g=a.extend(!0,{},e.options),h=a(e.container),i;a.isArray(h)&&(h=h[0]),e.dataView!==undefined?g.source=f.dataView[e.dataView]:c.dataView!==undefined&&(g.source=f.dataView[c.dataView]),i=e.type(h,g),d.presentation[e.label]=i,i.selfRender()}))})}),f.run=function(){a(document).ready(function(){a.each(g,function(a,b){b()}),f.ready=function(a){setTimeout(a,0)}})};return f}}(jQuery,MITHGrid),function(a,b){b.namespace("Plugin"),b.Plugin.initPlugin=function(b,c){var d={options:c,presentation:{}},e=[];d.getTypes=function(){return c.types!==undefined?c.types:[]},d.getProperties=function(){return c.properties!==undefined?c.properties:[]},d.getPresentations=function(){return c.presentations!==undefined?c.presentations:[]},d.ready=function(a){e.push(a)},d.eventReady=function(b){a.each(e,function(a,c){c(b)}),d.ready=function(a){a(b)}};return d}}(jQuery,MITHGrid),fluid.defaults("MITHGrid.Data.Source",{events:{onModelChange:null,onBeforeLoading:null,onAfterLoading:null,onBeforeUpdating:null,onAfterUpdating:null}}),fluid.defaults("MITHGrid.Data.View",{events:{onModelChange:null,onFilterItem:"preventable"}});